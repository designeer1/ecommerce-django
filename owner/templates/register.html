{% extends 'base.html' %}
{% block content %}
<div class="auth-container">
  <div class="auth-header">
    <h2>Create Account</h2>
    <p>Join TaskPro to get started</p>
  </div>
  
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <!-- Profile Picture Upload -->
    <div class="mb-4 text-center">
      <div class="profile-picture-container mb-3">
        <img id="profilePreview" src="/media/profiles/default.png" 
             class="rounded-circle border" 
             style="width: 120px; height: 120px; object-fit: cover; cursor: pointer;"
             onclick="document.getElementById('profile_picture').click()">
        <input type="file" id="profile_picture" name="profile_picture" 
               accept="image/jpeg,image/png" style="display: none;"
               onchange="previewProfilePicture(this)">
      </div>
      <label class="btn btn-outline-primary btn-sm">
        <i class="bi bi-camera me-1"></i> Upload Photo
        <input type="file" id="profile_picture_btn" name="profile_picture" 
               accept="image/jpeg,image/png" style="display: none;"
               onchange="previewProfilePicture(this)">
      </label>
      <div class="form-text">Click on image or button to upload profile picture (JPG/PNG, max 5MB)</div>
    </div>
    
    <div class="mb-3">
      <label class="form-label">Username</label>
      <input type="text" name="username" class="form-control" required placeholder="Choose a username">
    </div>
    
    <div class="mb-3">
      <label class="form-label">Email</label>
      <input type="email" name="email" class="form-control" required placeholder="Enter your email">
    </div>
    
    <div class="mb-3">
      <label class="form-label">Password</label>
      <input type="password" name="password" class="form-control" required placeholder="Create a password">
    </div>
    
    <button type="submit" class="btn btn-primary auth-btn">
      <i class="bi bi-person-plus me-2"></i> Register
    </button>
  </form>
  
  {% if msg %}
  <div class="alert alert-danger mt-3" role="alert">
    <i class="bi bi-exclamation-circle me-2"></i> {{ msg }}
  </div>
  {% endif %}
  
  <div class="text-center mt-4">
    <p class="mb-0">Already have an account? <a href="{% url 'login' %}" class="text-decoration-none fw-semibold">Login here</a></p>
  </div>
</div>

<style>
.profile-picture-container {
  position: relative;
  display: inline-block;
}

.profile-picture-container img {
  transition: all 0.3s ease;
  border: 3px solid #e9ecef;
}

.profile-picture-container img:hover {
  border-color: var(--primary-color);
  transform: scale(1.05);
}

.profile-picture-container::after {
  content: 'ðŸ“·';
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: var(--primary-color);
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.profile-picture-container:hover::after {
  opacity: 1;
}

.btn-outline-primary {
  border-radius: 20px;
  padding: 0.4rem 1rem;
}
</style>

<script>
function previewProfilePicture(input) {
  const preview = document.getElementById('profilePreview');
  const fileBtn = document.getElementById('profile_picture_btn');
  
  if (input.files && input.files[0]) {
    const file = input.files[0];
    
    // Validate file size (5MB max)
    if (file.size > 5 * 1024 * 1024) {
      alert('File size too large! Maximum size is 5MB.');
      input.value = '';
      return;
    }
    
    // Validate file type
    const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
    if (!validTypes.includes(file.type)) {
      alert('Only JPG and PNG files are allowed!');
      input.value = '';
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
    }
    reader.readAsDataURL(file);
    
    // Sync both file inputs
    if (input.id === 'profile_picture') {
      fileBtn.files = input.files;
    } else {
      document.getElementById('profile_picture').files = input.files;
    }
  }
}

// Make the profile picture clickable
document.getElementById('profilePreview').addEventListener('click', function() {
  document.getElementById('profile_picture').click();
});

// Add hover effect
document.getElementById('profilePreview').addEventListener('mouseenter', function() {
  this.style.opacity = '0.8';
});

document.getElementById('profilePreview').addEventListener('mouseleave', function() {
  this.style.opacity = '1';
});
</script>
{% endblock %}