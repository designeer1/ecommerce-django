{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Manage Subcategories</h2>

  <!-- Subcategory Add form -->
  <form method="post" enctype="multipart/form-data" class="row g-2 mb-4">
    {% csrf_token %}
    <div class="col-md-2">
      <select name="category" class="form-select" required>
        <option value="" disabled selected>Select Category</option>
        {% for cat in categories %}
          <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <input type="text" name="name" placeholder="Enter product name"
             class="form-control" required>
    </div>
    <div class="col-md-2">
      <input type="text" name="subcategory" placeholder="Enter subcategory"
             class="form-control" required>
    </div>
    <div class="col-md-2">
      <input type="number" name="price" placeholder="Price" class="form-control" step="0.01" required>
    </div>
    <div class="col-md-3">
      <input type="file" name="image" accept="image/*" class="form-control" required>
    </div>
    <div class="col-md-1 d-grid">
      <button type="submit" class="btn btn-primary">Add</button>
    </div>
  </form>

  <!-- Subcategories table -->
  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Category</th>
        <th>Name</th>
        <th>Subcategory</th>
        <th>Price</th>
        <th class="text-end">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for cat, subcat_list in subcategories.items %}
        {% for subcat in subcat_list %}
          <tr>
            <td>{{ forloop.parentloop.counter0|add:forloop.counter }}</td>
            <td>{{ cat }}</td>
            <td>{{ subcat.name }}</td>
            <td>{{ subcat.subcategory }}</td>
            <td>â‚¹{{ subcat.price }}</td>
            <td class="text-end">
              <a href="{% url 'edit_subcategory' cat subcat.name %}" class="btn btn-sm btn-warning">Edit</a>
              <a href="{% url 'delete_subcategory' cat subcat.name %}" class="btn btn-sm btn-danger"
                 onclick="return confirm('Delete {{ subcat.name }} under {{ cat }}?');">Delete</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center">No subcategories yet</td>
          </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
