{% extends "customer/base.html" %}
{% block content %}

<h2 class="mb-4 text-center"><i class="bi bi-bag-check"></i> Completed Cart</h2>

{% if products %}
<div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
  <table class="table table-bordered align-middle text-center" style="table-layout: fixed; width: 100%;">
    <thead class="table-primary sticky-top">
      <tr>
        <th style="width: 12%;">Order ID</th>
        <th style="width: 15%;">Image</th>
        <th style="width: 25%;">Product</th>
        <th style="width: 15%;">Price</th>
        <th style="width: 15%;">Quantity</th>
        <th style="width: 18%;">Total</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>2327{{ forloop.counter|stringformat:"03d" }}</td>
        <td>
          <img src="{{ product.image_path }}" class="img-fluid rounded" alt="{{ product.name }}" style="max-width:100px;">
        </td>
        <td class="text-truncate">{{ product.name }}</td>
        <td>₹ {{ product.price }}</td>
        <td>
          <div class="d-flex justify-content-center align-items-center">
            <a href="{% url 'decrement_cart_item' product.name %}" class="btn btn-sm btn-outline-danger me-2">−</a>
            <span class="fw-bold">{{ product.quantity }}</span>
            <a href="{% url 'increment_cart_item' product.name %}" class="btn btn-sm btn-outline-success ms-2">+</a>
          </div>
        </td>
        <td class="fw-bold">₹ {{ product.total_price }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ✅ Grand total shown outside the scroll area -->
<div class="mt-3 text-end">
  <h4 class="fw-bold">Grand Total: <span class="text-primary">₹ {{ grand_total }}</span></h4>
</div>

<!-- ✅ Buttons -->
<div class="d-flex justify-content-between mt-4">
  <a href="{% url 'customer_cart' %}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Back
  </a>
  <a href="{% url 'checkout_address' %}" class="btn btn-success">
    <i class="bi bi-check2-circle"></i> Proceed
  </a>
</div>

{% else %}
<p class="text-center mt-5">Your cart is empty.</p>
{% endif %}

{% endblock %}
