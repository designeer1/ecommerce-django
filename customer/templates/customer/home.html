{% extends "customer/base.html" %}
{% load static %}
{% block content %}

<!-- ðŸ”¹ Modern Hero Section -->
<section class="hero-section mb-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-4 fw-bold mb-3">Discover Amazing Products</h1>
        <p class="lead mb-4">Explore our curated collection of premium items designed to elevate your lifestyle.</p>
        <div class="d-flex gap-3 flex-wrap">
          <a href="#productGrid" class="btn btn-primary btn-lg rounded-pill px-4">
            <i class="fas fa-shopping-bag me-2"></i>Shop Now
          </a>
          <a href="#featured" class="btn btn-outline-light btn-lg rounded-pill px-4">
            <i class="fas fa-star me-2"></i>Featured
          </a>
        </div>
      </div>
      <div class="col-lg-6 text-center">
        <div class="hero-visual">
          <div class="floating-card card-1">
            <i class="fas fa-tshirt"></i>
          </div>
          <div class="floating-card card-2">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <div class="floating-card card-3">
            <i class="fas fa-laptop"></i>
          </div>
          <div class="floating-card card-4">
            <i class="fas fa-headphones"></i>
          </div>
          <div class="main-circle">
            <i class="fas fa-store"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ðŸ”¹ Product Section -->
<div class="container py-5" id="productGrid">
  <!-- Header with Icon -->
  <div class="d-flex align-items-center justify-content-center mb-4">
    <div class="me-3">
      <i class="fas fa-shopping-bag fs-1 text-primary"></i>
    </div>
    <div>
      <h2 class="mb-0 fw-bold gradient-text">Explore Products</h2>
      <p class="text-light">Browse our wide range of products</p>
    </div>
  </div>

  <!-- Search & Filter Controls -->
  <div class="card mb-5 hackerrank-card">
    <div class="card-body p-4">
      <h5 class="card-title mb-4"><i class="fas fa-filter me-2"></i>Search & Filter</h5>
      <div class="row g-3">
        <div class="col-md-6">
          <div class="position-relative">
            <span class="position-absolute top-50 start-0 translate-middle-y ms-3">
              <i class="fas fa-search text-muted"></i>
            </span>
            <input type="text" id="searchProductInput" class="form-control ps-5 hackerrank-input" placeholder="Search products by name...">
            <ul id="searchDropdown" class="list-group position-absolute w-100 shadow-lg mt-1" 
                style="z-index:1050; display:none; max-height:280px; overflow-y:auto; border-radius:12px;"></ul>
          </div>
        </div>
        <div class="col-md-6">
          <div class="d-flex align-items-center gap-3 flex-wrap">
            <label for="priceFilter" class="fw-bold mb-0 flex-shrink-0">Max Price (â‚¹):</label>
            <div class="position-relative flex-grow-1" style="max-width: 150px;">
              <span class="position-absolute top-50 start-0 translate-middle-y ms-2">
                <i class="fas fa-indian-rupee-sign text-muted"></i>
              </span>
              <input type="number" id="priceFilter" min="0" step="0.01" class="form-control ps-4 hackerrank-input" placeholder="No limit">
            </div>
            <button id="applyFilterBtn" class="btn btn-primary flex-shrink-0">
              <i class="fas fa-check me-1"></i>Apply
            </button>
            <button id="clearFiltersBtn" class="btn btn-outline-light flex-shrink-0">
              <i class="fas fa-times me-1"></i>Clear
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4" id="productGrid">
    {% for product in products %}
      <div class="col product-col" data-price="{{ product.price }}" data-name="{{ product.name|lower }}">
        <div class="card h-100 product-card hackerrank-card">
          <div class="position-relative">
            <div class="card-img-top-container">
              <img src="{{ product.image_path|default:'/static/images/default.png' }}" class="card-img-top" alt="{{ product.name }}">
            </div>
            <div class="card-price-badge">â‚¹ {{ product.price }}</div>
          </div>
          <div class="card-body text-center pb-0">
            <h5 class="card-title fw-bold text-truncate">{{ product.name }}</h5>
          </div>
          <div class="card-footer bg-transparent border-0 pt-0">
            <a href="{% url 'add_to_cart' product.name %}" class="btn btn-success w-100 rounded-pill">
              <i class="fas fa-cart-plus me-2"></i>Add to Cart
            </a>
            <a href="{% url 'product_detail' product.name %}" class="btn btn-outline-light w-100 rounded-pill mt-2">
              <i class="fas fa-eye me-2"></i>View Details
            </a>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12 text-center py-5">
        <i class="fas fa-box-open fs-1 text-light mb-3"></i>
        <h4 class="text-light">No products found</h4>
        <p class="text-light">Check back later for new products!</p>
      </div>
    {% endfor %}
  </div>
</div>

<!-- ðŸ”¹ New Product Notification -->
{% if new_product_added %}
  <div class="alert alert-success alert-dismissible fade show fixed-bottom m-3" role="alert" style="z-index: 1100;">
    <i class="fas fa-check-circle me-2"></i>
    <strong>{{ new_product_added }}</strong> has been added to your cart!
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
{% endif %}

<!-- ðŸ”¹ Enhanced Footer Banner -->
<div class="footer-banner">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <i class="fas fa-bolt me-2"></i>
        <span>Welcome to TaskPro â€” Shop the best products today!</span>
      </div>
      <div>
        <span class="badge hackerrank-badge">Products: {{ products|length }}</span>
      </div>
    </div>
  </div>
</div>

<style>
/* ðŸ”¹ Import Font Awesome */
@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');

/* ðŸ”¹ HackerRank Theme Background */
body {
  background-color: #1e1e1e;
  color: #f2f2f2;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(0, 97, 153, 0.1) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(0, 97, 153, 0.1) 0%, transparent 20%),
    radial-gradient(circle at 50% 50%, rgba(42, 170, 138, 0.05) 0%, transparent 80%);
}

/* ðŸ”¹ Modern Hero Section */
.hero-section {
  padding: 4rem 0;
  background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
  border-radius: 0 0 30px 30px;
  border-bottom: 1px solid #2a8ab8;
}

.hero-visual {
  position: relative;
  height: 300px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.main-circle {
  width: 150px;
  height: 150px;
  background: linear-gradient(45deg, #1e1e1e, #2a8ab8);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #42b983;
  font-size: 3rem;
  box-shadow: 0 10px 30px rgba(66, 185, 131, 0.3);
  z-index: 2;
  border: 2px solid #2a8ab8;
}

.floating-card {
  position: absolute;
  width: 70px;
  height: 70px;
  border-radius: 15px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #f2f2f2;
  font-size: 1.5rem;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  animation: float 3s infinite ease-in-out;
  background: linear-gradient(45deg, #1e1e1e, #2a2a2a);
  border: 1px solid #2a8ab8;
}

.card-1 {
  top: 20px;
  left: 50px;
  animation-delay: 0s;
  color: #42b983;
}

.card-2 {
  top: 20px;
  right: 50px;
  animation-delay: 0.5s;
  color: #2a8ab8;
}

.card-3 {
  bottom: 20px;
  left: 50px;
  animation-delay: 1s;
  color: #ff6b6b;
}

.card-4 {
  bottom: 20px;
  right: 50px;
  animation-delay: 1.5s;
  color: #ffd43b;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

/* ðŸ”¹ Gradient Text */
.gradient-text {
  background: linear-gradient(45deg, #2a8ab8, #42b983);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ðŸ”¹ HackerRank Card Style */
.hackerrank-card {
  background-color: #2a2a2a;
  border: 1px solid #3e3e3e;
  border-radius: 8px;
  color: #f2f2f2;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.hackerrank-input {
  background-color: #1e1e1e;
  border: 1px solid #3e3e3e;
  color: #f2f2f2;
}

.hackerrank-input:focus {
  background-color: #1e1e1e;
  border-color: #2a8ab8;
  color: #f2f2f2;
  box-shadow: 0 0 0 0.2rem rgba(42, 138, 184, 0.25);
}

.hackerrank-badge {
  background-color: #2a8ab8;
  color: #f2f2f2;
}

/* ðŸ”¹ Enhanced Product Cards */
.product-card {
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s ease;
  background: #2a2a2a;
  position: relative;
}
.product-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.3) !important;
  border-color: #2a8ab8;
}
.card-img-top-container {
  height: 220px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
}
.card-img-top-container img {
  max-height: 85%;
  max-width: 85%;
  object-fit: contain;
  transition: transform 0.5s ease;
}
.product-card:hover .card-img-top-container img {
  transform: scale(1.08);
}
.card-price-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: rgba(42, 138, 184, 0.9);
  color: white;
  padding: 5px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.9rem;
  backdrop-filter: blur(4px);
}

/* ðŸ”¹ Enhanced Footer Banner */
.footer-banner {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  background: linear-gradient(90deg, #1e1e1e, #2a2a2a);
  color: #f2f2f2;
  font-weight: 500;
  padding: 12px 0;
  font-size: 1rem;
  z-index: 1050;
  border-top: 1px solid #2a8ab8;
}

/* ðŸ”¹ Enhanced Search Dropdown */
#searchDropdown {
  max-height: 280px;
  overflow-y: auto;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  padding: 0.75rem;
  z-index: 1100;
  background: #2a2a2a;
  border-radius: 8px;
  border: 1px solid #3e3e3e;
}
#searchDropdown li {
  cursor: default;
  background: #2a2a2a;
  margin-bottom: 8px;
  border: 1px solid #3e3e3e;
  border-radius: 8px;
  padding: 12px;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.2s ease;
}
#searchDropdown li:hover {
  background: #3a3a3a;
  transform: translateX(5px);
}
#searchDropdown img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
#searchDropdown .product-info {
  flex-grow: 1;
}
#searchDropdown .product-name {
  font-weight: 600;
  margin: 0;
  color: #f2f2f2;
}
#searchDropdown .product-price {
  color: #2a8ab8;
  font-weight: bold;
  margin: 2px 0 8px 0;
}
#searchDropdown .btn-group {
  display: flex;
  gap: 6px;
}

/* ðŸ”¹ Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-track {
  background: #1e1e1e;
  border-radius: 10px;
}
::-webkit-scrollbar-thumb {
  background: linear-gradient(45deg, #2a8ab8, #42b983);
  border-radius: 10px;
}

/* ðŸ”¹ Highlight for filtered products */
.product-highlight {
  background-color: rgba(42, 138, 184, 0.1) !important;
  border: 2px solid #2a8ab8 !important;
}

/* ðŸ”¹ Animation for cards */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.product-col {
  animation: fadeIn 0.5s ease forwards;
  animation-delay: calc(var(--delay, 0) * 0.1s);
}

/* ðŸ”¹ Button Styles */
.btn-primary {
  background: linear-gradient(45deg, #2a8ab8, #42b983);
  border: none;
}

.btn-success {
  background: linear-gradient(45deg, #42b983, #2a8ab8);
  border: none;
}

.btn-outline-light {
  border-color: #3e3e3e;
  color: #f2f2f2;
}

.btn-outline-light:hover {
  background-color: #3e3e3e;
  border-color: #3e3e3e;
  color: #f2f2f2;
}

/* ðŸ”¹ Responsive adjustments */
@media (max-width: 768px) {
  .hero-section {
    text-align: center;
    padding: 2rem 0;
  }
  .hero-visual {
    height: 200px;
    margin-top: 2rem;
  }
  .main-circle {
    width: 100px;
    height: 100px;
    font-size: 2rem;
  }
  .floating-card {
    width: 50px;
    height: 50px;
    font-size: 1rem;
  }
  .card-1 {
    top: 10px;
    left: 20px;
  }
  .card-2 {
    top: 10px;
    right: 20px;
  }
  .card-3 {
    bottom: 10px;
    left: 20px;
  }
  .card-4 {
    bottom: 10px;
    right: 20px;
  }
  .card-img-top-container { height: 180px; }
  .footer-banner .container > div {
    flex-direction: column;
    gap: 10px;
    text-align: center;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const searchInput = document.getElementById("searchProductInput");
  const resultsList = document.getElementById("searchDropdown");
  const productGrid = document.getElementById("productGrid");
  const priceFilterInput = document.getElementById("priceFilter");
  const applyFilterBtn = document.getElementById("applyFilterBtn");
  const clearFiltersBtn = document.getElementById("clearFiltersBtn");

  // Pass URL patterns to JavaScript
  const addToCartBaseUrl = "{% url 'add_to_cart' 'placeholder' %}".replace('placeholder', '');
  const productDetailBaseUrl = "{% url 'product_detail' 'placeholder' %}".replace('placeholder', '');

  // Initialize tooltips if any
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  // Add animation delays to product cards
  document.querySelectorAll('.product-col').forEach((card, index) => {
    card.style.setProperty('--delay', index);
  });

  // Store original products for filtering
  const originalProducts = Array.from(productGrid.querySelectorAll(".product-col"));

  // Function to filter products
  function filterProducts() {
    const searchQuery = searchInput.value.trim().toLowerCase();
    const maxPrice = parseFloat(priceFilterInput.value);

    originalProducts.forEach(product => {
      const price = parseFloat(product.dataset.price);
      const name = product.dataset.name;

      const matchesSearch = searchQuery === '' || name.includes(searchQuery);
      const matchesPrice = isNaN(maxPrice) || price <= maxPrice;

      if (matchesSearch && matchesPrice) {
        product.style.display = "";
        if (searchQuery !== '') {
          product.querySelector('.product-card').classList.add('product-highlight');
        } else {
          product.querySelector('.product-card').classList.remove('product-highlight');
        }
      } else {
        product.style.display = "none";
        product.querySelector('.product-card').classList.remove('product-highlight');
      }
    });
  }

  // Clear all filters
  function clearAllFilters() {
    searchInput.value = "";
    priceFilterInput.value = "";
    resultsList.style.display = "none";
    originalProducts.forEach(product => {
      product.style.display = "";
      product.querySelector('.product-card').classList.remove('product-highlight');
    });
  }

  // Fetch live search results
  searchInput.addEventListener("keyup", function() {
    const query = this.value.trim();
    filterProducts();

    if (query.length < 2) {
      resultsList.style.display = "none";
      return;
    }

    fetch("{% url 'search_products' %}?q=" + encodeURIComponent(query))
      .then(res => res.json())
      .then(data => {
        resultsList.innerHTML = "";
        if (data.results.length === 0) {
          const li = document.createElement("li");
          li.className = "text-center text-muted py-3";
          li.innerHTML = '<i class="fas fa-search me-2"></i> No products found';
          resultsList.appendChild(li);
          resultsList.style.display = "block";
          return;
        }

        data.results.forEach(product => {
          const encodedName = encodeURIComponent(product.name);
          const addToCartUrl = `${addToCartBaseUrl}${encodedName}/`;
          const productDetailUrl = `${productDetailBaseUrl}${encodedName}/`;
          const li = document.createElement("li");
          li.innerHTML = `
            <img src="${product.image_path || '/static/images/default.png'}" alt="${product.name}">
            <div class="product-info">
              <p class="product-name text-truncate mb-1">${product.name}</p>
              <p class="product-price">â‚¹ ${parseFloat(product.price).toFixed(2)}</p>
              <div class="btn-group">
                <a href="${addToCartUrl}" class="btn btn-success btn-sm">
                  <i class="fas fa-cart-plus"></i> Add
                </a>
                <a href="${productDetailUrl}" class="btn btn-outline-light btn-sm">
                  <i class="fas fa-eye"></i> View
                </a>
              </div>
            </div>
          `;
          resultsList.appendChild(li);
        });
        resultsList.style.display = "block";
      });
  });

  applyFilterBtn.addEventListener("click", filterProducts);
  clearFiltersBtn.addEventListener("click", clearAllFilters);

  document.addEventListener("click", function(event) {
    if (!resultsList.contains(event.target) && event.target !== searchInput) {
      resultsList.style.display = "none";
    }
  });

  // Show cart notification if new product added
  const newProduct = "{{ new_product_added|escapejs }}";
  if (newProduct && newProduct !== "None") {
    const alert = document.querySelector('.alert-success');
    if (alert) {
      alert.classList.add('show');
    }
  }
});
</script>

{% endblock %}