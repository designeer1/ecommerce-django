{% extends 'superadmin/base.html' %}
{% block content %}

<div class="dashboard-header d-flex justify-content-between align-items-center">
  <div>
    <h1 class="display-5 fw-bold text-gradient-premium">Owner Profile</h1>
    <p class="lead text-muted">Detailed analytics for {{ owner.username }}'s store</p>
  </div>
  <a href="{% url 'superadmin_dashboard' %}" class="btn btn-outline-premium rounded-pill">
    <i class="bi bi-arrow-left me-2"></i> Back to Dashboard
  </a>
</div>

<!-- Calculate real inventory value -->
{% with total_inventory_value=0 %}
  {% for product in products %}
    {% with total_inventory_value=total_inventory_value|add:product.price %}
    {% endwith %}
  {% endfor %}
{% endwith %}

<!-- Owner Profile Card -->
<div class="row mb-5">
  <div class="col-lg-4">
    <div class="card border-0 shadow-premium">
      <div class="card-body text-center p-4">
        <div class="position-relative d-inline-block mb-3">
          <div class="premium-profile-frame">
            <img src="{{ owner.profile_picture }}" 
                 class="rounded-circle premium-profile-img" 
                 width="140" 
                 height="140"
                 onerror="this.src='/media/profiles/default.png'">
          </div>
          <span class="position-absolute bottom-0 end-0 premium-online-indicator">
            <i class="bi bi-check-circle-fill"></i>
          </span>
        </div>
        
        <h3 class="h4 mb-1 premium-text-gradient">{{ owner.username }}</h3>
        <p class="text-muted mb-3">{{ owner_email }}</p>
        
        <div class="premium-badge-large mb-3">
          <i class="bi bi-box-seam me-1"></i> {{ product_count }} Products
        </div>

        {% if django_user %}
        <div class="premium-info-card">
          <div class="d-flex align-items-center justify-content-center">
            <i class="bi bi-patch-check-fill text-premium me-2"></i>
            <small class="text-premium fw-semibold">Verified Store Owner</small>
          </div>
          <small class="text-muted">Member since {{ django_user.date_joined|date:"M d, Y" }}</small>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-8">
    <!-- Statistics Cards with Real Data -->
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card border-0 premium-card-primary">
          <div class="card-body text-center p-4">
            <div class="premium-icon-wrapper mb-3">
              <i class="bi bi-box-seam premium-icon"></i>
            </div>
            <h2 class="fw-bold mb-1 premium-counter" data-target="{{ product_count }}">0</h2>
            <p class="mb-0 opacity-75">Total Products</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card border-0 premium-card-info">
          <div class="card-body text-center p-4">
            <div class="premium-icon-wrapper mb-3">
              <i class="bi bi-tags premium-icon"></i>
            </div>
            <h2 class="fw-bold mb-1 premium-counter" data-target="{{ categories_count }}">0</h2>
            <p class="mb-0 opacity-75">Categories</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card border-0 premium-card-success">
          <div class="card-body text-center p-4">
            <div class="premium-icon-wrapper mb-3">
              <i class="bi bi-currency-rupee premium-icon"></i>
            </div>
            <h2 class="fw-bold mb-1">
              ₹<span class="premium-counter" data-target="{{ total_inventory_value|floatformat:0 }}">0</span>
            </h2>
            <p class="mb-0 opacity-75">Inventory Value</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Metrics -->
    <div class="card border-0 shadow-premium">
      <div class="card-body p-4">
        <h5 class="card-title mb-4 premium-title">
          <i class="bi bi-graph-up me-2"></i>Performance Metrics
        </h5>
        <div class="row">
          <div class="col-md-6">
            <div class="premium-metric-card">
              <div class="premium-metric-icon">
                <i class="bi bi-currency-exchange"></i>
              </div>
              <div>
                <small class="text-muted d-block">Avg. Product Price</small>
                <strong>₹{{ average_price|floatformat:2 }}</strong>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="premium-metric-card">
              <div class="premium-metric-icon">
                <i class="bi bi-star"></i>
              </div>
              <div>
                <small class="text-muted d-block">Store Rating</small>
                <strong>
                  {{ store_rating|floatformat:1 }} 
                  <i class="bi bi-star-fill text-warning"></i>
                </strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Products Section - Dark Theme -->
<div class="dark-theme-container">
  <div class="card border-0 dark-theme-card">
    <div class="card-header dark-theme-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h4 class="mb-1 text-white">
            <i class="bi bi-box-seam me-2"></i>Product Catalog
          </h4>
          <p class="text-light mb-0">Total inventory value: ₹{{ total_inventory_value|floatformat:2 }}</p>
        </div>
        <span class="dark-theme-badge">
          {{ product_count }} Items
        </span>
      </div>
    </div>
    
    <div class="card-body p-4">
      {% if products %}
      <div class="row g-4">
        {% for product in products %}
        <div class="col-xl-3 col-lg-4 col-md-6">
          <div class="dark-product-card">
            <div class="dark-product-image-container">
              <img src="{% if product.image %}{{ product.image }}{% elif product.image_path %}{{ product.image_path }}{% else %}/media/products/default.png{% endif %}" 
                   class="dark-product-image" 
                   alt="{{ product.name }}"
                   onerror="this.src='/media/products/default.png'">
              <div class="dark-product-overlay">
                <div class="dark-product-actions">
                  <button class="dark-action-btn" data-bs-toggle="tooltip" title="Quick View">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="dark-action-btn" data-bs-toggle="tooltip" title="Edit Product">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="dark-action-btn" data-bs-toggle="tooltip" title="Add to Favorites">
                    <i class="bi bi-heart"></i>
                  </button>
                </div>
                <span class="dark-product-price">₹{{ product.price }}</span>
              </div>
              <span class="dark-product-badge {% if product.type == 'subcategory' %}bg-info{% else %}bg-warning{% endif %}">
                {{ product.type|title }}
              </span>
            </div>
            
            <div class="dark-product-content">
              <h6 class="dark-product-title">{{ product.name }}</h6>
              
              <div class="dark-product-categories">
                <span class="dark-category-tag">
                  <i class="bi bi-tag me-1"></i>{{ product.category }}
                </span>
                {% if product.subcategory %}
                <span class="dark-category-tag">
                  <i class="bi bi-diagram-3 me-1"></i>{{ product.subcategory }}
                </span>
                {% endif %}
              </div>
              
              <p class="dark-product-description">
                {{ product.description|default:"No description available"|truncatewords:15 }}
              </p>
              
              <div class="dark-product-footer">
                <div class="dark-product-rating">
                  <div class="dark-stars">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-half"></i>
                  </div>
                  <small class="text-muted">4.5</small>
                </div>
                
                <div class="dark-status-indicator"></div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center py-5 dark-empty-state">
        <div class="mb-4">
          <i class="bi bi-inbox display-1 text-light opacity-25"></i>
        </div>
        <h4 class="text-light mb-3">No Products Found</h4>
        <p class="text-light mb-4">This store hasn't added any products yet.</p>
        <button class="btn btn-outline-light">
          <i class="bi bi-plus-circle me-1"></i> Add First Product
        </button>
      </div>
      {% endif %}
    </div>
    
    {% if products %}
    <div class="card-footer dark-theme-footer">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <span class="text-muted small">Showing {{ products|length }} of {{ product_count }} products</span>
        </div>
        <nav aria-label="Product pagination">
          <ul class="pagination pagination-sm mb-0 dark-pagination">
            <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1">
                <i class="bi bi-chevron-left"></i>
              </a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
              <a class="page-link" href="#">
                <i class="bi bi-chevron-right"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
/* Dark Theme Variables */
:root {
  --dark-bg: #1a1d21;
  --dark-card: #24292e;
  --dark-card-hover: #2d333b;
  --dark-header: #1c2128;
  --dark-footer: #1c2128;
  --dark-text: #e6edf3;
  --dark-text-muted: #7d8590;
  --dark-border: #3e4c5a;
  --dark-primary: #6f42c1;
  --dark-accent: #8b5cf6;
  --dark-success: #10b981;
  --dark-info: #0ea5e9;
  --dark-warning: #f59e0b;
  --dark-danger: #ef4444;
}

/* Dark Theme Container */
.dark-theme-container {
  background: var(--dark-bg);
  border-radius: 16px;
  overflow: hidden;
}

.dark-theme-card {
  background: var(--dark-card);
  border: 1px solid var(--dark-border);
  border-radius: 16px;
}

.dark-theme-header {
  background: var(--dark-header);
  border-bottom: 1px solid var(--dark-border);
  padding: 1.25rem 1.5rem;
}

.dark-theme-footer {
  background: var(--dark-footer);
  border-top: 1px solid var(--dark-border);
  padding: 1rem 1.5rem;
}

.dark-theme-badge {
  background: linear-gradient(135deg, var(--dark-primary), var(--dark-accent));
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.875rem;
}

/* Dark Product Card */
.dark-product-card {
  background: var(--dark-card);
  border: 1px solid var(--dark-border);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  height: 100%;
}

.dark-product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  border-color: var(--dark-primary);
}

/* Dark Product Image */
.dark-product-image-container {
  position: relative;
  height: 180px;
  overflow: hidden;
}

.dark-product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.dark-product-card:hover .dark-product-image {
  transform: scale(1.05);
}

.dark-product-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 12px;
}

.dark-product-card:hover .dark-product-overlay {
  opacity: 1;
}

.dark-product-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

.dark-action-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--dark-bg);
  transition: all 0.2s ease;
}

.dark-action-btn:hover {
  background: white;
  transform: scale(1.1);
}

.dark-product-price {
  background: linear-gradient(135deg, var(--dark-primary), var(--dark-accent));
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9rem;
  align-self: flex-start;
}

.dark-product-badge {
  position: absolute;
  top: 12px;
  left: 12px;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.7rem;
  font-weight: 600;
  color: white;
}

/* Dark Product Content */
.dark-product-content {
  padding: 16px;
}

.dark-product-title {
  color: var(--dark-text);
  font-weight: 600;
  font-size: 0.95rem;
  margin-bottom: 8px;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.dark-product-categories {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 12px;
}

.dark-category-tag {
  background: rgba(255, 255, 255, 0.1);
  color: var(--dark-text-muted);
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.75rem;
  display: flex;
  align-items: center;
}

.dark-product-description {
  color: var(--dark-text-muted);
  font-size: 0.85rem;
  line-height: 1.5;
  margin-bottom: 16px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Dark Product Footer */
.dark-product-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.dark-product-rating {
  display: flex;
  align-items: center;
  gap: 6px;
}

.dark-stars {
  display: flex;
  gap: 2px;
  color: var(--dark-warning);
}

.dark-status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--dark-success);
  position: relative;
}

.dark-status-indicator::after {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: var(--dark-success);
  opacity: 0.6;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 0.6;
  }
  50% {
    transform: scale(2);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 0.6;
  }
}

/* Dark Empty State */
.dark-empty-state {
  opacity: 0.8;
}

/* Dark Pagination */
.dark-pagination .page-link {
  background: var(--dark-card);
  border-color: var(--dark-border);
  color: var(--dark-text);
}

.dark-pagination .page-link:hover {
  background: var(--dark-primary);
  border-color: var(--dark-primary);
  color: white;
}

.dark-pagination .page-item.active .page-link {
  background: var(--dark-primary);
  border-color: var(--dark-primary);
}

/* Premium Color Scheme (Keep from previous) */
:root {
  --premium-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --premium-secondary: linear-gradient(135deg, #2a8ab8 0%, #42b983 100%);
  --premium-success: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  --premium-warning: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
  --premium-info: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
  --premium-dark: #2d3436;
  --premium-light: #f8f9fa;
  --premium-gold: #ffd700;
  --premium-silver: #c0c0c0;
}

/* Premium Text Effects */
.text-gradient-premium {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.premium-text-gradient {
  background: linear-gradient(135deg, #2d3436 0%, #667eea 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Premium Cards */
.premium-card-primary { background: var(--premium-primary); color: white; }
.premium-card-info { background: var(--premium-info); color: white; }
.premium-card-success { background: var(--premium-success); color: white; }

.premium-card-primary,
.premium-card-info,
.premium-card-success {
  border-radius: 20px;
  transition: all 0.3s ease;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.premium-card-primary:hover,
.premium-card-info:hover,
.premium-card-success:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

/* Premium Badges */
.premium-badge-large {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 8px 16px;
  border-radius: 25px;
  font-weight: 600;
  display: inline-block;
}

/* Premium Icons */
.premium-icon-wrapper {
  width: 60px;
  height: 60px;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
}

.premium-icon {
  font-size: 1.5rem;
}

/* Premium Profile Frame */
.premium-profile-frame {
  position: relative;
  display: inline-block;
  border-radius: 50%;
  padding: 4px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.premium-profile-img {
  border: 3px solid white;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.premium-online-indicator {
  background: #28a745;
  color: white;
  border-radius: 50%;
  padding: 4px;
  border: 2px solid white;
}

/* Premium Shadows */
.shadow-premium {
  box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important;
  border-radius: 20px;
}

/* Premium Card Header */
.premium-card-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-bottom: 1px solid rgba(0,0,0,0.05);
  border-radius: 20px 20px 0 0 !important;
}

/* Premium Title */
.premium-title {
  color: #2d3436;
  font-weight: 600;
}

/* Premium Info Card */
.premium-info-card {
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  padding: 15px;
  border-radius: 15px;
  border: 1px solid rgba(0,0,0,0.05);
}

/* Premium Metric Cards */
.premium-metric-card {
  display: flex;
  align-items: center;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 12px;
}

.premium-metric-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 15px;
}

/* Premium Button */
.btn-outline-premium {
  border: 2px solid #667eea;
  color: #667eea;
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-outline-premium:hover {
  background: #667eea;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

/* Animations */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dark-product-card {
  animation: fadeInUp 0.6s ease forwards;
  opacity: 0;
}

/* Staggered animation for product cards */
.dark-product-card:nth-child(1) { animation-delay: 0.1s; }
.dark-product-card:nth-child(2) { animation-delay: 0.2s; }
.dark-product-card:nth-child(3) { animation-delay: 0.3s; }
.dark-product-card:nth-child(4) { animation-delay: 0.4s; }
.dark-product-card:nth-child(5) { animation-delay: 0.5s; }
.dark-product-card:nth-child(6) { animation-delay: 0.6s; }
.dark-product-card:nth-child(7) { animation-delay: 0.7s; }
.dark-product-card:nth-child(8) { animation-delay: 0.8s; }
</style>

<script>
// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
  // Tooltip initialization
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
  
  // Counter animation
  const counters = document.querySelectorAll('.premium-counter');
  const speed = 200;
  
  counters.forEach(counter => {
    const target = +counter.getAttribute('data-target');
    const count = +counter.innerText;
    const increment = target / speed;
    
    if (count < target) {
      counter.innerText = Math.ceil(count + increment);
      setTimeout(() => {
        counter.innerText = target.toLocaleString();
      }, 1);
    } else {
      counter.innerText = target.toLocaleString();
    }
  });
  
  // Parallax effect for profile image
  const profileImg = document.querySelector('.premium-profile-img');
  if (profileImg) {
    document.addEventListener('mousemove', function(e) {
      const moveX = (e.clientX - window.innerWidth / 2) / 25;
      const moveY = (e.clientY - window.innerHeight / 2) / 25;
      profileImg.style.transform = `translate(${moveX}px, ${moveY}px)`;
    });
  }
});
</script>

{% endblock %}